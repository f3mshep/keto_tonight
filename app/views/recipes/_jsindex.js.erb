
class RecipeCard{
    constructor(recipe){
        this.title = recipe.title;
        this.image = recipe.image;
        this.commentCount = recipe.comments.length;
        this.recipeURL = "/users/" + recipe.user.id + "/recipes/" + recipe.id;
    }

    cardBuilder(){
        var recipeCard = document.createElement("div")
        recipeCard.className ="col-md-4"
        recipeCard.innerHTML = "<%=j render(partial: 'recipe_card_template')%>";
        recipeCard.getElementsByClassName("recipePath")[0].href = this.recipeURL
        recipeCard.getElementsByClassName("recipePath")[1].href = this.recipeURL
        recipeCard.getElementsByClassName("recipeImage")[0].src = this.image
        recipeCard.getElementsByClassName("card-title")[0].innerHTML = this.title
        recipeCard.getElementsByClassName("recipeCommentCount")[0].innerHTML = this.commentCount + ' comments'
        document.getElementsByClassName("row")[0].appendChild(recipeCard)
    }

}

function requestRecipes(){
    let path = window.location.href.replace(/https?:\/\/localhost:3000/, "")
    
    if(path.includes("commit")){
        path = path + "&request=true"
    }
    else {
        path = path + ".json"
    }
    $.get(path, function(recipes){
        for (const recipe of recipes) {
            let card = new RecipeCard(recipe);
            card.cardBuilder()
        }
    })
}

// function requestRecipes(){
//     var urlToParse = window.location.href.replace(/https?:\/\/localhost:3000/, "")
//     var result = parseQueryString(urlToParse);
//     result.request = "true"
//     $.ajax({
//         url: urlToParse ,
//         type: "GET",
//         data: result,
//         success: function(recipes){
//             for (const recipe of recipes) {
//                 var card = new RecipeCard(recipe);
//                 card.cardBuilder()
//             }
//         },
//     })
// }

$(function(){
    requestRecipes()
});

// var parseQueryString = function (url) {
//     var urlParams = {};
//     url.replace(
//         new RegExp("([^?=&]+)(=([^&]*))?", "g"),
//         function ($0, $1, $2, $3) {
//             urlParams[$1] = $3;
//         }
//     );

//     return urlParams;
// }